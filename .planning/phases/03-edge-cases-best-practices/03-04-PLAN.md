---
phase: 03-edge-cases-best-practices
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/polymarket/library/README.md
  - skills/polymarket/library/error-handling.md
autonomous: true

must_haves:
  truths:
    - "User can catch and handle PolyApiException with status codes"
    - "User can categorize errors by type (auth, funds, precision, order)"
    - "User can apply correct recovery action for each error category"
    - "User knows common error messages and their solutions"
  artifacts:
    - path: "skills/polymarket/library/README.md"
      provides: "Library section index"
      min_lines: 30
    - path: "skills/polymarket/library/error-handling.md"
      provides: "Exception types and error recovery patterns"
      contains: "PolyApiException"
  key_links:
    - from: "skills/polymarket/library/README.md"
      to: "skills/polymarket/library/error-handling.md"
      via: "index link"
      pattern: "error-handling"
    - from: "skills/polymarket/library/error-handling.md"
      to: "skills/polymarket/auth/client-initialization.md"
      via: "reference for credential refresh"
      pattern: "client-initialization"
---

<objective>
Create library documentation section with comprehensive py-clob-client error handling patterns.

Purpose: Proper error handling is essential for production code. Users need to know exception types, common error messages, and recovery patterns.

Output: library/README.md, library/error-handling.md
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-edge-cases-best-practices/03-RESEARCH.md

# Existing documentation to reference
@skills/polymarket/auth/client-initialization.md
@skills/polymarket/trading/order-placement.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create library README and error handling guide</name>
  <files>
    skills/polymarket/library/README.md
    skills/polymarket/library/error-handling.md
  </files>
  <action>
Create library/README.md as index:
- Title: "py-clob-client Library Reference"
- Brief intro: Official Python client for Polymarket CLOB
- Version: 0.34.5+
- Navigation to library docs
- Link to GitHub repo

Create library/error-handling.md (LIB-03):

**Title:** "Error Handling and Exception Types"

**Exception Hierarchy:**
```python
from py_clob_client.exceptions import PolyException, PolyApiException

# PolyException - Base exception for all py-clob-client errors
class PolyException(Exception):
    def __init__(self, msg):
        self.msg = msg

# PolyApiException - API-specific errors with HTTP status codes
class PolyApiException(PolyException):
    # Attributes:
    # - status_code: HTTP status (400, 401, 404, 429, 5xx)
    # - error_msg: Detailed error message
```

**Status Code Reference:**
| Code | Meaning | Action |
|------|---------|--------|
| 400 | Bad Request | Check parameters, precision, balance |
| 401 | Unauthorized | Refresh API credentials |
| 404 | Not Found | Invalid endpoint or resource |
| 429 | Rate Limited | Requests queued, wait or slow down |
| 5xx | Server Error | Retry with exponential backoff |

**Error Categorization Pattern:**
Include `place_order_safely()` function from research that categorizes errors:
- authentication category -> refresh credentials
- insufficient_funds category -> check USDC.e balance
- precision category -> adjust size/price precision
- validation category -> check order parameters

**Common Error Messages and Solutions:**
Include ERROR_SOLUTIONS dictionary from research:

| Error Message | Category | Solution |
|---------------|----------|----------|
| "Invalid api key" | auth | Call create_or_derive_api_creds() |
| "Invalid L1 Request headers" | auth | Check signature_type matches wallet |
| "not enough balance / allowance" | funds | Check USDC.e balance and allowances |
| "insufficient balance" | funds | Verify funder address has USDC.e |
| "invalid amounts" | precision | Round FOK to 2 decimals |
| "INVALID_ORDER_MIN_TICK_SIZE" | precision | Fetch current tick size |
| "order crosses book" | order | Post-only cannot be marketable |
| "FOK_ORDER_NOT_FILLED_ERROR" | order | Insufficient liquidity, use FAK |
| "MARKET_NOT_READY" | market | Wait and retry |

**Recovery Patterns:**

1. **401 Unauthorized Recovery:**
```python
try:
    response = client.post_order(signed_order, order_type)
except PolyApiException as e:
    if e.status_code == 401:
        # Refresh credentials
        client.set_api_creds(client.create_or_derive_api_creds())
        # Retry
        response = client.post_order(signed_order, order_type)
```

2. **Precision Error Recovery:**
```python
try:
    response = client.post_order(signed_order, OrderType.FOK)
except PolyApiException as e:
    if "invalid amounts" in str(e.error_msg).lower():
        # Fall back to GTC which has looser precision
        response = client.post_order(signed_order, OrderType.GTC)
```

3. **Rate Limit Handling:**
```python
# Note: 429 errors mean requests are QUEUED, not dropped
# Polymarket uses Cloudflare throttling
try:
    response = client.post_order(signed_order, order_type)
except PolyApiException as e:
    if e.status_code == 429:
        # Wait before next request
        time.sleep(1)
        response = client.post_order(signed_order, order_type)
```

Reference client-initialization.md for credential setup.
  </action>
  <verify>
Files exist at skills/polymarket/library/README.md and error-handling.md.
error-handling.md contains PolyApiException documentation.
error-handling.md contains ERROR_SOLUTIONS table.
Contains recovery pattern examples.
References client-initialization.md.
  </verify>
  <done>
Library section created with comprehensive error handling guide covering all exception types, common errors, and recovery patterns.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update edge-cases README with complete navigation</name>
  <files>skills/polymarket/edge-cases/README.md</files>
  <action>
Update edge-cases/README.md (if created in Plan 01) to ensure complete navigation:

Ensure the README includes links to all edge case documents created in plans 01-03:
- usdc-token-confusion.md
- order-constraints.md
- price-interpretation.md
- resolution-mechanics.md
- negrisk-trading.md
- partial-fills.md

Add "Quick Troubleshooting" table:
| Symptom | See |
|---------|-----|
| Polymarket shows $0.00 balance | usdc-token-confusion.md |
| "invalid amounts" error | order-constraints.md |
| Order rejected after tick size check | order-constraints.md |
| Expected midpoint fill, got worse | price-interpretation.md |
| Market ended but no payout | resolution-mechanics.md |
| Confused about negRisk outcomes | negrisk-trading.md |
| Need to track partial fills | partial-fills.md |

Add link to library/README.md for py-clob-client specifics.

Note: If Plan 01 hasn't run yet, this task creates the README with all planned links. Plans execute in parallel so README may need both creation and update logic.
  </action>
  <verify>
edge-cases/README.md exists with links to all 6 edge case documents.
Contains Quick Troubleshooting table.
Links to library section.
  </verify>
  <done>
Edge cases README provides complete navigation to all edge case documentation with symptom-based quick lookup.
  </done>
</task>

</tasks>

<verification>
- [ ] library/README.md exists as library section index
- [ ] library/error-handling.md exists with exception documentation
- [ ] All common error messages documented with solutions
- [ ] Recovery patterns include code examples
- [ ] edge-cases/README.md links to all edge case docs
</verification>

<success_criteria>
1. User can import and catch PolyApiException
2. User can categorize errors and apply correct recovery
3. User knows all common error messages and their fixes
4. LIB-03 requirement satisfied
5. Edge cases section fully navigable
</success_criteria>

<output>
After completion, create `.planning/phases/03-edge-cases-best-practices/03-04-SUMMARY.md`
</output>
