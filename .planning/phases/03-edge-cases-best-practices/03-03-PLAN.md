---
phase: 03-edge-cases-best-practices
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/polymarket/edge-cases/negrisk-trading.md
  - skills/polymarket/edge-cases/partial-fills.md
autonomous: true

must_haves:
  truths:
    - "User can identify augmented negRisk events and know to avoid unnamed outcomes"
    - "User understands only one outcome resolves YES in negRisk"
    - "User can track partial fills and reconcile positions"
    - "User understands GTC/FAK partial fill behavior vs FOK"
  artifacts:
    - path: "skills/polymarket/edge-cases/negrisk-trading.md"
      provides: "NegRisk trading rules and pitfalls"
      contains: "negRiskAugmented"
    - path: "skills/polymarket/edge-cases/partial-fills.md"
      provides: "Partial fill tracking and reconciliation"
      contains: "PartialFillTracker"
  key_links:
    - from: "skills/polymarket/edge-cases/negrisk-trading.md"
      to: "skills/polymarket/market-discovery/events-and-metadata.md"
      via: "reference link"
      pattern: "events-and-metadata"
    - from: "skills/polymarket/edge-cases/partial-fills.md"
      to: "skills/polymarket/trading/order-management.md"
      via: "reference link"
      pattern: "order-management"
---

<objective>
Document NegRisk multi-outcome trading patterns and partial fill tracking for order reconciliation.

Purpose: NegRisk is Polymarket's most complex market type - trading unnamed outcomes is a common mistake. Partial fills require tracking for accurate position management.

Output: edge-cases/negrisk-trading.md, edge-cases/partial-fills.md
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-edge-cases-best-practices/03-RESEARCH.md

# Existing documentation to reference
@skills/polymarket/market-discovery/events-and-metadata.md
@skills/polymarket/trading/order-management.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NegRisk trading patterns guide</name>
  <files>skills/polymarket/edge-cases/negrisk-trading.md</files>
  <action>
Create edge-cases/negrisk-trading.md (EDGE-07):

**Title:** "NegRisk Multi-Outcome Market Patterns"

**What is NegRisk?**
Brief recap (detail in events-and-metadata.md):
- Multiple mutually exclusive outcomes
- Only ONE can resolve YES
- Capital efficient: buying YES in all costs $1 (guaranteed $1 payout)

**Key Fields:**
| Field | Type | Meaning |
|-------|------|---------|
| negRisk | boolean | Basic negRisk event |
| enableNegRisk | boolean | NegRisk enabled |
| negRiskAugmented | boolean | Can add new outcomes |

**The Unnamed Outcome Pitfall:**
CRITICAL WARNING: Augmented negRisk events have placeholder/unnamed outcomes.

When `enableNegRisk=true` AND `negRiskAugmented=true`:
- New outcomes can be added over time
- Unnamed outcomes are placeholders ("Other" or empty)
- Unnamed outcomes can CHANGE definition
- ONLY trade named outcomes

Include `is_tradable_negrisk_outcome()` detection from research:
```python
def is_tradable_negrisk_outcome(event, market):
    """Check if a negRisk outcome should be traded."""
    if not event.get("negRisk"):
        return True  # Not negRisk, normal rules apply

    if event.get("negRiskAugmented"):
        # Only trade named outcomes
        question = market.get("question", "")
        return bool(question) and question.lower() != "other"

    return True
```

Include `analyze_negrisk_event()` from research for comprehensive analysis.

**Trading Considerations:**

| Aspect | Standard Markets | NegRisk Markets |
|--------|-----------------|-----------------|
| Max outcomes | 2 (YES/NO) | Many (one winner) |
| Price sum | YES + NO = ~1.0 | All YES = ~1.0 |
| Capital for all YES | 2.0 | 1.0 |
| Conversion | N/A | NO to YES available |

**Price Analysis:**
- Sum of all YES prices should be ~1.0
- Overround = sum - 1.0 (market edge)
- If overround > 0.05, check for mispricing

**Warning Signs:**
- Outcome name is empty or "Other"
- Event has negRiskAugmented=true
- Polymarket UI doesn't show the outcome

Reference events-and-metadata.md for basic negRisk field documentation.
  </action>
  <verify>
File exists at skills/polymarket/edge-cases/negrisk-trading.md.
Contains is_tradable_negrisk_outcome() function.
Contains analyze_negrisk_event() function.
Contains warning about unnamed outcomes.
References events-and-metadata.md.
  </verify>
  <done>
NegRisk trading guide documents the unnamed outcome pitfall and provides detection functions for safe trading.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create partial fill tracking guide</name>
  <files>skills/polymarket/edge-cases/partial-fills.md</files>
  <action>
Create edge-cases/partial-fills.md (EDGE-09):

**Title:** "Partial Fill Tracking and Reconciliation"

**Why Partial Fills Matter:**
- GTC orders fill incrementally over time
- FAK orders fill best-effort, remainder cancelled
- Position tracking requires accurate fill data
- Tax/accounting needs complete fill history

**Order Response Fields:**
| Field | Type | Description |
|-------|------|-------------|
| original_size | float | What was requested |
| size_matched | float | What has filled |
| price_average | float | Weighted average fill price |
| status | string | LIVE, MATCHED, CANCELLED |

**Which Order Types Have Partial Fills:**
| Type | Partial Fills? | Behavior |
|------|----------------|----------|
| GTC | Yes | Fills over time, rests on book |
| GTD | Yes | Fills until expiration |
| FOK | No | All or nothing |
| FAK | Yes | Best effort, remainder cancelled |

**PartialFillTracker Class:**
Include the full PartialFillTracker class from research:
- track_order() to start tracking
- update_from_response() to record fills
- get_fill_summary() for reconciliation

**Reconciliation Patterns:**

1. **Real-time tracking (WebSocket):**
   - Subscribe to user channel
   - Update tracker on each order_fill event

2. **Polling-based tracking:**
   - Query order status periodically
   - Compare size_matched to previous

3. **End-of-day reconciliation:**
   - Query positions endpoint
   - Compare expected vs actual position size
   - Log discrepancies for investigation

**Example: Track and Reconcile:**
```python
tracker = PartialFillTracker()

# Place order
response = client.post_order(signed_order, OrderType.GTC)
tracker.track_order(response["orderID"], 100.0)

# Later: update from status check
status = client.get_order(order_id)
tracker.update_from_response(status)

# Get summary
summary = tracker.get_fill_summary(order_id)
print(f"Filled: {summary['filled_size']} / {summary['original_size']}")
print(f"Remaining: {summary['remaining_size']}")
print(f"Avg Price: {summary['avg_price']}")
```

Reference order-management.md for order status checking.
  </action>
  <verify>
File exists at skills/polymarket/edge-cases/partial-fills.md.
Contains PartialFillTracker class.
Contains order type partial fill comparison table.
References order-management.md.
  </verify>
  <done>
Partial fills guide provides tracking patterns and reconciliation for accurate position management.
  </done>
</task>

</tasks>

<verification>
- [ ] edge-cases/negrisk-trading.md exists with unnamed outcome detection
- [ ] edge-cases/partial-fills.md exists with PartialFillTracker class
- [ ] Both files reference existing Phase 2 documentation appropriately
- [ ] All critical warnings are prominent
</verification>

<success_criteria>
1. User can detect and avoid unnamed negRisk outcomes
2. User can analyze negRisk event pricing for arbitrage potential
3. User can track partial fills across order lifecycle
4. User can reconcile expected vs actual positions
5. EDGE-07, EDGE-09 requirements satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/03-edge-cases-best-practices/03-03-SUMMARY.md`
</output>
