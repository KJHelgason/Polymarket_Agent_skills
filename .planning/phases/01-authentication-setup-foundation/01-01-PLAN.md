---
phase: 01-authentication-setup-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/polymarket/auth/authentication-flow.md
  - skills/polymarket/auth/api-credentials.md
autonomous: true

must_haves:
  truths:
    - "Claude can explain L1 vs L2 authentication difference when asked"
    - "Claude knows EIP-712 is used for L1 wallet signatures"
    - "Claude knows HMAC-SHA256 is used for L2 API authentication"
    - "Claude can explain how to create, store, and recover API credentials"
    - "Claude knows create_or_derive_api_creds() vs create_api_key() difference"
  artifacts:
    - path: "skills/polymarket/auth/authentication-flow.md"
      provides: "L1/L2 authentication architecture documentation"
      contains: "EIP-712"
    - path: "skills/polymarket/auth/api-credentials.md"
      provides: "API credential management documentation"
      contains: "create_or_derive_api_creds"
  key_links:
    - from: "skills/polymarket/auth/authentication-flow.md"
      to: "skills/polymarket/auth/api-credentials.md"
      via: "L1 generates L2 credentials reference"
      pattern: "api-credentials"
---

<objective>
Document Polymarket's two-tier authentication architecture (L1 wallet signatures, L2 API credentials) and API credential lifecycle management.

Purpose: Claude needs to understand how authentication works to guide users through initial setup and troubleshoot auth errors.
Output: Two markdown skill files covering authentication flow and credential management.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-authentication-setup-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create L1/L2 Authentication Flow Documentation</name>
  <files>skills/polymarket/auth/authentication-flow.md</files>
  <action>
Create comprehensive documentation explaining Polymarket's two-tier authentication:

**Structure:**
1. Overview - What L1 and L2 mean in Polymarket context
2. L1 Authentication (Wallet Signatures)
   - EIP-712 structured data signing
   - ClobAuthDomain domain separator
   - When L1 is used (initial setup, credential creation)
3. L2 Authentication (API Requests)
   - HMAC-SHA256 signature scheme
   - Required headers: POLY-ADDRESS, POLY-SIGNATURE, POLY-TIMESTAMP, POLY-NONCE, POLY-PASSPHRASE
   - 30-second timestamp expiration
   - Replay attack prevention
4. Authentication Flow Diagram (ASCII or mermaid)
   - Wallet signs L1 -> generates API credentials -> L2 signs each request
5. Common Authentication Errors
   - 400 "invalid signature" - wrong signature_type
   - 401 "Unauthorized/Invalid api key" - expired or wrong credentials
   - 401 "Invalid L1 Request headers" - malformed L1 request

**Source:** Draw from 01-RESEARCH.md sections on authentication architecture, Common Pitfalls #1.

**Format:** Claude skill markdown with clear sections, code examples where helpful, no emojis.
  </action>
  <verify>
- File exists at skills/polymarket/auth/authentication-flow.md
- Contains sections on L1 (EIP-712) and L2 (HMAC-SHA256)
- Includes error troubleshooting guidance
- No placeholder text or TODOs
  </verify>
  <done>
Documentation explains L1/L2 authentication architecture with code examples and error guidance. Requirement AUTH-01 satisfied.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create API Credential Management Documentation</name>
  <files>skills/polymarket/auth/api-credentials.md</files>
  <action>
Create documentation covering API credential lifecycle:

**Structure:**
1. Overview - What API credentials are (apiKey, secret, passphrase)
2. Creating Credentials
   - create_or_derive_api_creds() - preferred method (retrieves existing or creates new)
   - create_api_key(nonce) - explicit creation with nonce tracking
   - When each method is appropriate
3. Storing Credentials Securely
   - Environment variables pattern
   - Secure file storage with proper permissions
   - What to store (key, secret, passphrase, AND nonce)
4. Credential Recovery
   - derive_api_key(nonce) for recovery when nonce is known
   - What happens when nonce is lost (must create new, invalidates previous)
5. Credential Rotation
   - When rotation is needed
   - Process: create new -> update client -> old automatically invalidated
6. Code Examples
   - Initial setup with nonce tracking
   - Loading saved credentials
   - Recovery pattern

**Anti-patterns to document:**
- Using create_api_key() for initial setup (always invalidates previous)
- Not saving nonce (makes recovery impossible)

**Source:** Draw from 01-RESEARCH.md Pattern 2, Common Pitfalls #3, API Credential Management code examples.

**Format:** Claude skill markdown with working code examples.
  </action>
  <verify>
- File exists at skills/polymarket/auth/api-credentials.md
- Documents create_or_derive_api_creds() as preferred method
- Includes nonce tracking pattern
- Includes recovery example
- No placeholder text or TODOs
  </verify>
  <done>
Documentation covers API credential creation, storage, recovery, and rotation. Requirement AUTH-03 satisfied.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Both files exist in skills/polymarket/auth/
2. Files cross-reference each other appropriately
3. Content is derived from researched patterns, not invented
4. Documentation is actionable (Claude could guide a user through auth setup)
</verification>

<success_criteria>
- AUTH-01 (L1/L2 auth flow) documented with code examples
- AUTH-03 (API credentials) documented with lifecycle management
- Both files are complete, no TODOs or placeholders
- Documentation follows skill format conventions
</success_criteria>

<output>
After completion, create `.planning/phases/01-authentication-setup-foundation/01-01-SUMMARY.md`
</output>
